# Session 3 — Add Registration Route + CSS Styling

**Date:** 2026-02-07
**Work Item:** TN-FEATURE-SCRUM-32-STUDENT-REGISTRATION-SCREEN
**Objective:** Wire up `/register` route and apply full CSS styling to registration form

---

## Micro-Step 1: Add `/register` Route to `appRoutes`

### TDD Phase: RED → GREEN

**What:** Add a route entry for `/register` pointing to the `Registration` standalone component.
**Why:** The Registration component exists but is unreachable — no route mapping in `app.routes.ts`.
**Story Alignment:** AC1 requires "I am on the student registration page" — needs a routable path.

#### RED Phase

- Write test in `app.routes.spec.ts` asserting `/register` route exists, maps to `Registration`, and has correct title.

#### GREEN Phase

- Add route entry to `app.routes.ts`.

---

### Execution Log

**RED Phase:**
- Created `app.routes.spec.ts` with 3 tests:
  1. `/register` route exists
  2. Maps to `Registration` component
  3. Title is `Student Registration`
- Result: 3/3 FAIL ✅ (expected)

**GREEN Phase:**
- Added `Registration` import and `/register` route entry in `app.routes.ts`
- Result: 3/3 route tests PASS ✅

**Full Suite Validation:**
- 6 suites, 113/113 tests pass ✅
- No regressions

**Files Modified:**
- `apps/student-app/src/app/app.routes.ts` — Added `/register` route
- `apps/student-app/src/app/app.routes.spec.ts` — NEW: 3 route config tests

---

## Micro-Step 2: Apply CSS Styling to Registration Form

### Phase: Implementation (no TDD — pure visual, no behavioral changes)

**What:** Populate `registration.css` with full component styles.
**Why:** AC7 requires responsive layout; story spec requires center-aligned card max-width 600px.
**Safety net:** All 113 existing tests serve as regression guard.

### Design System Alignment

- CSS variables from global `styles.scss` (`--primary-color`, `--border-radius`, `--shadow-*`, etc.)
- Child-friendly: rounded corners (16px), large touch targets (50px+ buttons), 16px font
- Center-aligned card, max-width 600px, white background, medium shadow
- Responsive: 3 breakpoints (desktop, tablet ≤768px, mobile ≤480px)
- Animations: fadeSlideIn for container, stepSlideIn for step transitions

### Sections Styled

| Section | Class(es) | Key Properties |
|---------|-----------|----------------|
| Host layout | `:host` | full-height, padding, bg-primary |
| Card container | `.registration-container` | max-width 600px, centered, rounded, shadow |
| Screen reader | `.sr-only` | visually hidden, accessible |
| Progress indicator | `.progress-indicator` | centered pill badge |
| Step content | `.step-content`, `h2` | slide-in animation, blue underline header |
| Form fields | `.form-field` | spaced fields, styled inputs with focus/valid/invalid states |
| Select dropdown | `.form-field select` | custom chevron, appearance reset |
| Error messages | `.error-message` | red text, fade-in animation |
| Password requirements | `.password-requirements` | info box with blue left border |
| Password strength | `.password-strength`, `.strength-label` | inline badge |
| Checkboxes | `.checkbox-group`, `.checkbox-label` | flex wrap, pill-style, hover/checked highlight |
| Avatar grid | `.avatar-grid`, `.avatar-option` | 4-col grid, border highlight, scale on selected |
| Buttons | `.form-actions button` | primary (blue), .primary (green), .secondary (ghost), back (ghost left-aligned) |
| Login link | `.login-link-container` | centered, top border divider |
| Animations | 3 keyframes | fadeSlideIn, stepSlideIn, fadeIn |
| Tablet (≤768px) | | 3-col avatars, smaller padding/fonts |
| Mobile (≤480px) | | stacked buttons, full-width checkboxes, column-reverse actions |

### Execution Log

- Wrote ~370 lines of CSS to `registration.css`
- Full suite: 6 suites, 113/113 tests PASS ✅
- No regressions

**Files Modified:**
- `apps/student-app/src/app/features/registration.css` — Full styling implementation

---

## Micro-Step 3: Fix Per-Step Validation (Step 1 Next Button Bug)

### TDD Phase: RED → GREEN

**What:** Step 1 Next button was permanently disabled because `[disabled]="!registrationForm.valid"` checked the entire form including Step 2's `grade` (required, empty). Also, the email async validator keeps the field PENDING until API responds.
**Why:** AC2 states "Next button only enables when all validations pass" — referring to Step 1 validations only.
**Root Cause:** Template used whole-form validity instead of per-step validation.

### RED Phase (8 new tests)

| Test | Purpose |
|------|---------|
| Next button enabled with only Step 1 fields valid (grade empty) | Proves Step 1 validation is independent |
| Next button disabled when email invalid | Sync validation still blocks |
| Next button disabled when passwords mismatch | Cross-field validation still blocks |
| `isStep1Valid()` returns true with valid Step 1 data | Unit test for method |
| `isStep1Valid()` returns false with empty firstName | Required field blocks |
| `isStep1Valid()` returns false with password mismatch | Cross-field blocks |
| `isStep2Valid()` returns true with grade selected | Unit test for method |
| `isStep2Valid()` returns false with empty grade | Required field blocks |

- Existing test updated: removed `grade: '5'` from "should enable Next button when form is valid"
- Result: 7 FAIL ✅ (expected)

### GREEN Phase

**Implementation:**
- Added `isStep1Valid()`: checks firstName, lastName, password, confirmPassword (sync valid) + email (valid OR pending with no sync errors) + no passwordMismatch
- Added `isStep2Valid()`: checks grade valid
- Updated `registration.html`: Step 1 `[disabled]="!isStep1Valid()"`, Step 2 `[disabled]="!isStep2Valid()"`

**Key Design Decision:** Email PENDING state treated as acceptable for navigation — user shouldn't be blocked while debounced API check runs. If email is taken, the error shows but doesn't block until they return to Step 1.

### Execution Log

- RED: 7 failures, 81 passed (88 total)
- GREEN: 88/88 registration tests PASS ✅
- Full suite: 6 suites, 121/121 tests PASS ✅

**Files Modified:**
- `apps/student-app/src/app/features/registration.ts` — Added `isStep1Valid()`, `isStep2Valid()`
- `apps/student-app/src/app/features/registration.html` — Updated button disabled bindings
- `apps/student-app/src/app/features/registration.spec.ts` — 8 new tests, 1 updated

---

## Micro-Step 4: Add Password Visibility Toggle

### TDD Phase: RED → GREEN

**What:** Add show/hide toggle buttons to Password and Confirm Password fields with eye icons.
**Why:** Story UI/UX spec requires "password visibility toggle". Improves usability for young students.
**Story Alignment:** UI/UX Specifications → "Icons: Use for password visibility toggle"

### RED Phase (8 new tests)

| Test | Purpose |
|------|---------|
| Render toggle button for password field | DOM presence |
| Render toggle button for confirm password field | DOM presence |
| Default password input to type password | Initial state |
| Toggle password input type to text on click | Core behavior |
| Toggle back to password on second click | Round-trip |
| Toggle confirm password independently | Field isolation |
| Accessible aria-label for toggle | a11y: "Show password" |
| Update aria-label when toggled | a11y: "Hide password" |

- Result: 7 FAIL, 89 passed (96 total) ✅

### GREEN Phase

**Implementation:**
- `registration.ts`: Added `passwordVisible` record + `togglePasswordVisibility(field)` method
- `registration.html`: Wrapped password inputs in `.password-input-wrapper`, added toggle buttons with inline SVG eye icons (open/closed), dynamic `[type]` and `[attr.aria-label]` bindings
- `registration.css`: Positioned toggle button absolutely inside input wrapper with hover/focus styles

### Execution Log

- RED: 7 failures, 89 passed (96 total)
- GREEN: 96/96 registration tests PASS ✅
- Full suite: 6 suites, 129/129 tests PASS ✅

**Files Modified:**
- `apps/student-app/src/app/features/registration.ts` — Added `passwordVisible`, `togglePasswordVisibility()`
- `apps/student-app/src/app/features/registration.html` — Toggle buttons in both password fields
- `apps/student-app/src/app/features/registration.css` — `.password-input-wrapper`, `.toggle-password-btn` styles
- `apps/student-app/src/app/features/registration.spec.ts` — 8 new tests
---

## Micro-Step 5: Generate 15 SVG Avatar Files

### TDD Phase: N/A (Asset Creation — No Logic Change)

**What:** Create 15 child-friendly SVG avatar files and update component reference from `.png` to `.svg`.
**Why:** Registration Step 3 (Avatar Selection) references `/assets/avatars/avatar-{i}.png` but no avatar files exist. Users need visual avatars to choose from.
**Story Alignment:** AC6 — "I can choose an avatar for my profile from a selection of child-friendly options."

#### Plan

1. Create 15 unique SVG avatar files (child-friendly animal/character faces) in `apps/student-app/public/assets/avatars/`
2. Update `registration.ts` to reference `.svg` instead of `.png`
3. Verify all 129 tests remain green

### Execution Log

**Avatar Files Created (15 total):**
| # | File | Character | Primary Color |
|---|------|-----------|---------------|
| 0 | `avatar-0.svg` | Happy Cat | Orange |
| 1 | `avatar-1.svg` | Cool Dog | Brown |
| 2 | `avatar-2.svg` | Wise Owl | Purple |
| 3 | `avatar-3.svg` | Friendly Bear | Warm Brown |
| 4 | `avatar-4.svg` | Happy Bunny | Pink |
| 5 | `avatar-5.svg` | Playful Fox | Orange |
| 6 | `avatar-6.svg` | Friendly Panda | Black/White |
| 7 | `avatar-7.svg` | Happy Penguin | Blue-Black |
| 8 | `avatar-8.svg` | Cool Lion | Golden |
| 9 | `avatar-9.svg` | Friendly Frog | Green |
| 10 | `avatar-10.svg` | Cute Koala | Gray |
| 11 | `avatar-11.svg` | Magic Unicorn | Purple/Pink |
| 12 | `avatar-12.svg` | Friendly Robot | Blue |
| 13 | `avatar-13.svg` | Cute Dinosaur | Green |
| 14 | `avatar-14.svg` | Friendly Dragon | Teal |

**Component Update:**
- `registration.ts` line 71: Changed `.png` → `.svg` in `availableAvatars` URL template

**Validation:**
- Full suite: 6 suites, 129/129 tests PASS ✅
- Zero regressions

**Files Modified:**
- `apps/student-app/src/app/features/registration.ts` — `.png` → `.svg` reference
- `apps/student-app/public/assets/avatars/avatar-0.svg` through `avatar-14.svg` — 15 new SVG files

---

## Micro-Step 6: Password Complexity Validator

### TDD Phase: RED → GREEN

**What:** Add custom validator enforcing AC2 password rules (1 uppercase, 1 number, 1 special char).
**Why:** Story AC2 requires "8+ chars, 1 uppercase, 1 number, 1 special char" but only `minLength(8)` was enforced. Users could proceed with weak passwords.
**Story Alignment:** AC2 — "Password must meet requirements: 8+ chars, 1 uppercase, 1 number, 1 special char"

### Execution Log

- RED: 5 tests written → 4 failures confirmed (1 vacuously passed since no `passwordComplexity` error yet)
- GREEN: Added `passwordComplexityValidator()` method, applied to password form control, added error message handling
- All 134/134 tests PASS ✅

**Files Modified:**
- `apps/student-app/src/app/features/registration.ts` — Added `passwordComplexityValidator()`, applied to password control, added error message
- `apps/student-app/src/app/features/registration.spec.ts` — 5 new tests in "Password Complexity Validation" describe block

---

## Micro-Step 7: Success Flow (Notification + Redirect)

### TDD Phase: RED → GREEN

**What:** Add success notification display and Router navigation after successful registration.
**Why:** AC5 requires "Success notification displayed" and "Redirect to onboarding tutorial or dashboard". Previous implementation had a TODO placeholder.
**Story Alignment:** AC5 — "Success notification displayed", "Redirect to onboarding tutorial or dashboard"

### Execution Log

- RED: 4 tests written (registrationSuccess flag, Router.navigate, success template element, no success on error) → 4 failures confirmed
- GREEN: Added `registrationSuccess` property, `Router` injection, navigate to `/achievements` on success, success notification `<div>` in template, `.success-notification` CSS
- All 138/138 tests PASS ✅

**Files Modified:**
- `apps/student-app/src/app/features/registration.ts` — Added `registrationSuccess`, Router injection, navigate on success
- `apps/student-app/src/app/features/registration.html` — Success notification `<div>` with `data-testid="registration-success"`
- `apps/student-app/src/app/features/registration.css` — `.success-notification` styles
- `apps/student-app/src/app/features/registration.spec.ts` — 4 new tests, added Router mock to TestBed

---

## Coverage Verification

**Coverage Report (student-app):**
| Metric | All Files | registration.ts |
|---|---|---|
| Statements | 93.96% | 89.62% |
| Branches | 78.21% | 75% |
| Functions | 95% | 90.9% |
| Lines | 93.6% | 89.31% |

✅ Story DoD requires >85% unit test coverage — **93.96% overall** exceeds requirement.

---

## Session 3 Summary

| Step | Description | Tests Added | Total Tests |
|---|---|---|---|
| MS1 | `/register` route | 3 | 113 |
| MS2 | CSS styling | 0 | 113 |
| MS3 | Per-step validation fix | 8 | 121 |
| MS4 | Password visibility toggle | 8 | 129 |
| MS5 | SVG avatar generation | 0 | 129 |
| MS6 | Password complexity validator | 5 | 134 |
| MS7 | Success flow (notification + redirect) | 4 | 138 |

**Final State:** 6 suites, 138/138 tests PASS, 93.96% coverage
